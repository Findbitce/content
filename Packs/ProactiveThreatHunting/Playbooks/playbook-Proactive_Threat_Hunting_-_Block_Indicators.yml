description: This playbook will be executed from the "Proactive Threat Hunting" layout button with the objective of blocking indicators specified by the analyst.
id: Proactive Threat Hunting - Block Indicators
inputs: []
name: Proactive Threat Hunting - Block Indicators
outputs: []
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "15"
      - "8"
      - "9"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 373d00c0-6e3b-4a0d-8fdb-fd7e4ff82acf
      iscommand: false
      name: ""
      version: -1
      description: ''
    taskid: 373d00c0-6e3b-4a0d-8fdb-fd7e4ff82acf
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 450,
          "y": -940
        }
      }
  "1":
    continueonerrortype: ""
    fieldMapping:
    - incidentfield: Block Indicators Status
      output:
        simple: Executed
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "2"
    note: false
    quietmode: 0
    scriptarguments:
      query:
        simple: incident.id:${incident.id} tags:"Hunting Session - Exist In Environment"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Searches Cortex XSOAR Indicators.

        Search for XSOAR Indicators and returns the id, indicator_type, value, and score/verdict.

        You can add additional fields from the indicators using the add_field_to_context argument.
      id: 13569f3d-eefd-4c99-8d9d-a169f732f1c7
      iscommand: false
      name: Get indicators
      script: SearchIndicator
      type: regular
      version: -1
    taskid: 13569f3d-eefd-4c99-8d9d-a169f732f1c7
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 30,
          "y": 100
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    scriptarguments:
      AutoBlockIndicators:
        simple: "False"
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: XSOAR Remediation - Malicious URLs
      DomainToBlock:
        complex:
          accessor: value
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: foundIndicators.indicator_type
              operator: isEqualString
              right:
                value:
                  simple: domain
          root: foundIndicators
      FilesToBlock:
        complex:
          accessor: value
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: foundIndicators.indicator_type
              operator: isEqualString
              right:
                value:
                  simple: file
          root: foundIndicators
      IP:
        complex:
          accessor: value
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: foundIndicators.indicator_type
              operator: isEqualString
              right:
                value:
                  simple: IP
          root: foundIndicators
      InputEnrichment:
        simple: "False"
      RuleDirection:
        simple: outbound
      RuleName:
        simple: XSOAR - Block Indicators playbook - ${incident.id}
      URL:
        complex:
          accessor: value
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: foundIndicators.indicator_type
              operator: isEqualString
              right:
                value:
                  simple: url
          root: foundIndicators
      UserVerification:
        simple: "True"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 2c28f1e1-dbbd-41ed-8bcf-94075968d126
      iscommand: false
      name: Block Indicators - Generic v3
      playbookId: Block Indicators - Generic v3
      type: playbook
      version: -1
      description: ''
    taskid: 2c28f1e1-dbbd-41ed-8bcf-94075968d126
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 450,
          "y": 270
        }
      }
  "3":
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 08b09081-0f1c-42a0-8d02-9a58ac4088ca
      iscommand: false
      name: Done
      type: title
      version: -1
      description: ''
    taskid: 08b09081-0f1c-42a0-8d02-9a58ac4088ca
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 440
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: true
    quietmode: 0
    scriptarguments:
      value:
        simple: Block indicators procedure has executed. Follow the work plan to continue.
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Prints text to war room (Markdown supported)
      id: 9038c930-e180-482e-8b0f-583892205ba6
      iscommand: false
      name: Print update to notes
      script: Print
      type: regular
      version: -1
    taskid: 9038c930-e180-482e-8b0f-583892205ba6
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": -620
        }
      }
  "5":
    continueonerrortype: ""
    form:
      description: ""
      expired: false
      questions:
      - defaultrows: []
        fieldassociated: ""
        gridcolumns: []
        id: "0"
        label: ""
        labelarg:
          simple: Which IOCs To Block?
        options: []
        optionsarg:
        - simple: All IOCs that are related to the SDO
        - simple: IOCs detected in my environment
        placeholder: ""
        readonly: false
        required: false
        tooltip: ""
        type: singleSelect
      sender: ""
      title: Which IOCs To Block?
      totalanswers: 0
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc:
      body:
      cc:
      format: ""
      methods: []
      subject:
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: true
        retriescount: 2
        retriesinterval: 360
      to:
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: ''
      id: 473c446d-703e-48b8-872f-37bbd7ea2157
      iscommand: false
      name: Which IOCs To Block?
      type: collection
      version: -1
    taskid: 473c446d-703e-48b8-872f-37bbd7ea2157
    timertriggers: []
    type: collection
    view: |-
      {
        "position": {
          "x": 450,
          "y": -260
        }
      }
  "6":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                accessor: "0"
                root: Which IOCs To Block?.Answers
          operator: isEqualString
          right:
            value:
              simple: IOCs detected in my environment
      label: "yes"
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "7"
      "yes":
      - "1"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: ''
      id: 154ed5b6-90a1-44fd-82a5-9587a7980fe2
      iscommand: false
      name: Block only detected IOCs?
      type: condition
      version: -1
    taskid: 154ed5b6-90a1-44fd-82a5-9587a7980fe2
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 450,
          "y": -100
        }
      }
  "7":
    continueonerrortype: ""
    fieldMapping:
    - incidentfield: Block Indicators Status
      output:
        simple: Executed
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "2"
    note: false
    quietmode: 0
    scriptarguments:
      query:
        simple: incident.id:${incident.id} tags:"Hunting Session"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Searches Cortex XSOAR Indicators.

        Search for XSOAR Indicators and returns the id, indicator_type, value, and score/verdict.

        You can add additional fields from the indicators using the add_field_to_context argument.
      id: c3cce0f0-efa5-451e-805f-61c1aad85074
      iscommand: false
      name: Get indicators
      script: SearchIndicator
      type: regular
      version: -1
    taskid: c3cce0f0-efa5-451e-805f-61c1aad85074
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 100
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: foundIndicators
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      id: 5f157551-88c5-4df4-8754-672b18b2a6fd
      iscommand: false
      name: Delete context to avoid duplications - foundIndicators
      script: DeleteContext
      type: regular
      version: -1
    taskid: 5f157551-88c5-4df4-8754-672b18b2a6fd
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 880,
          "y": -800
        }
      }
  "9":
    continueonerrortype: ""
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: Which IOCs To Block?
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      id: fa3ec0b7-9d40-4f43-8855-64cd8bf4500c
      iscommand: false
      name: Delete context to avoid duplications - IOCs to block
      script: DeleteContext
      type: regular
      version: -1
    taskid: fa3ec0b7-9d40-4f43-8855-64cd8bf4500c
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 30,
          "y": -800
        }
      }
  "10":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: freestylehunt
                root: incident
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: "yes"
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "5"
      "yes":
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: ''
      id: 52f56513-cc9c-434f-8ea7-15e2dbcc3fe1
      iscommand: false
      name: Executed from freestyle hunt?
      type: condition
      version: -1
    taskid: 52f56513-cc9c-434f-8ea7-15e2dbcc3fe1
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 450,
          "y": -450
        }
      }
  "11":
    continueonerrortype: ""
    form:
      description: ""
      expired: false
      questions:
      - defaultrows: []
        fieldassociated: ""
        gridcolumns: []
        id: "0"
        label: ""
        labelarg:
          simple: Please Upload a CSV file
        options: []
        optionsarg: []
        placeholder: ""
        readonly: false
        required: false
        tooltip: ""
        type: attachments
      sender: ""
      title: Please Upload a CSV file
      totalanswers: 0
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc:
      body:
      cc:
      format: ""
      methods: []
      subject:
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: true
        retriescount: 2
        retriesinterval: 360
      to:
    nexttasks:
      '#none#':
      - "13"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |
        Creates a file (using the given data input or entry ID) and uploads it to the current investigation War Room.
      id: 1628a58e-a9f2-4374-820f-9574afe5ac12
      iscommand: false
      name: 'Upload a CSV file '
      type: collection
      version: -1
    taskid: 1628a58e-a9f2-4374-820f-9574afe5ac12
    timertriggers: []
    type: collection
    view: |-
      {
        "position": {
          "x": 900,
          "y": -260
        }
      }
  "13":
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    scriptarguments:
      entryID:
        complex:
          accessor: EntryID
          root: Please Upload a CSV file.Answers.0.[0]
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.extract.indicators
      id: 5e2137da-2a58-4950-8e7f-7759b14ba83d
      iscommand: true
      name: Extract Indicators From CSV
      script: Builtin|||extractIndicators
      type: regular
      version: -1
    taskid: 5e2137da-2a58-4950-8e7f-7759b14ba83d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 900,
          "y": -100
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    scriptarguments:
      AutoBlockIndicators:
        simple: "True"
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: XSOAR Remediation - Malicious URLs
      DomainToBlock:
        complex:
          accessor: Domain
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      EmailToBlock:
        complex:
          accessor: Indicator
          filters:
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: email
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - operator: uniq
      FilesToBlock:
        complex:
          accessor: File
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      IP:
        complex:
          accessor: IP
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      InputEnrichment:
        simple: "False"
      RuleDirection:
        simple: outbound
      RuleName:
        simple: XSOAR - Block Indicators playbook - ${incident.id}
      URL:
        complex:
          accessor: Indicator
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: url
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - operator: uniq
      UserVerification:
        simple: "False"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: |+
        This playbook blocks malicious indicators using all integrations that are enabled, using the following sub-playbooks:

        - Block URL - Generic v2
        - Block Account - Generic v2
        - Block IP - Generic v3
        - Block File - Generic v2
        - Block Email - Generic v2
        - Block Domain - Generic v2

      id: bc1e2558-c767-4191-8951-e3ea835a86fa
      iscommand: false
      name: Block Indicators - Generic v3
      playbookId: Block Indicators - Generic v3
      type: playbook
      version: -1
    taskid: bc1e2558-c767-4191-8951-e3ea835a86fa
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 900,
          "y": 270
        }
      }
  "15":
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: ExtractedIndicators
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      id: 2dabf83a-5538-4a01-8c1c-f7565198bb1a
      iscommand: false
      name: Delete context to avoid duplications - ExtractedIndicators
      script: DeleteContext
      type: regular
      version: -1
    taskid: 2dabf83a-5538-4a01-8c1c-f7565198bb1a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": -800
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "6_1_yes": 0.46,
      "6_7_#default#": 0.59
    },
    "paper": {
      "dimensions": {
        "height": 1445,
        "width": 1250,
        "x": 30,
        "y": -940
      }
    }
  }
tests:
- No tests (auto formatted)
fromversion: 6.9.0
